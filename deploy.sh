#!/bin/bash

# Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ - Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù†Ø´Ø±
# Smart Queue Management System - Deployment Script

echo "ğŸš€ Ø¨Ø¯Ø¡ Ù†Ø´Ø± Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ"
echo "======================================="

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
check_requirements() {
    echo "ğŸ“‹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª..."
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Git
    if ! command -v git &> /dev/null; then
        echo "âŒ Git ØºÙŠØ± Ù…Ø«Ø¨Øª. ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Git Ø£ÙˆÙ„Ø§Ù‹."
        exit 1
    fi
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Node.js
    if ! command -v node &> /dev/null; then
        echo "âŒ Node.js ØºÙŠØ± Ù…Ø«Ø¨Øª. ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Node.js Ø£ÙˆÙ„Ø§Ù‹."
        exit 1
    fi
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Firebase CLI
    if ! command -v firebase &> /dev/null; then
        echo "âŒ Firebase CLI ØºÙŠØ± Ù…Ø«Ø¨Øª. ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Firebase CLI Ø£ÙˆÙ„Ø§Ù‹."
        echo "ğŸ“ Ù„ØªØ«Ø¨ÙŠØª Firebase CLI: npm install -g firebase-tools"
        exit 1
    fi
    
    echo "âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…ØªÙˆÙØ±Ø©"
}

# Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
setup_firebase() {
    echo "ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase..."
    
    # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Firebase
    echo "ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Firebase..."
    firebase login
    
    # Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    echo "ğŸ“‹ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø´Ø±ÙˆØ¹ Firebase..."
    firebase projects:list
    echo "ğŸ“ Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:"
    read project_id
    
    if [ -z "$project_id" ]; then
        echo "âŒ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ø·Ù„ÙˆØ¨"
        exit 1
    fi
    
    firebase use $project_id
    echo "âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: $project_id"
}

# Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†
deploy_security_rules() {
    echo "ğŸ”’ Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†..."
    
    # Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Realtime Database
    echo "ğŸ“‹ Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Realtime Database..."
    firebase deploy --only database
    
    # Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Firestore
    echo "ğŸ“‹ Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Firestore..."
    firebase deploy --only firestore
    
    # Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Storage
    echo "ğŸ“‹ Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Storage..."
    firebase deploy --only storage
    
    echo "âœ… ØªÙ… Ù†Ø´Ø± Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†"
}

# Ù†Ø´Ø± Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
deploy_hosting() {
    echo "ğŸŒ Ù†Ø´Ø± Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹..."
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù firebase.json Ù„Ù„Ù€ Hosting
    cat > firebase.json << EOF
{
  "hosting": {
    "public": ".",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ]
  }
}
EOF
    
    # Ù†Ø´Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹
    firebase deploy --only hosting
    
    echo "âœ… ØªÙ… Ù†Ø´Ø± Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹"
}

# Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Auth
setup_auth() {
    echo "ğŸ” Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Auth..."
    
    # ØªÙØ¹ÙŠÙ„ Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    echo "ğŸ“§ ØªÙØ¹ÙŠÙ„ Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ..."
    firebase auth:email:enable
    
    # ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    echo "ğŸ˜· ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„Ø©..."
    firebase auth:anonymous:enable
    
    echo "âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Auth"
}

# Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
setup_initial_data() {
    echo "ğŸ—„ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©..."
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ
    echo "ğŸ‘¤ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ..."
    echo "ğŸ“ Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø£Ø¯Ù…Ù†:"
    read admin_email
    
    echo "ğŸ“ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù„Ø£Ø¯Ù…Ù†:"
    read -s admin_password
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ (ÙŠØ¬Ø¨ ØªÙ†ÙÙŠØ°Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ Firebase Console)
    echo "âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ Firebase Console:"
    echo "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: $admin_email"
    echo "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: $admin_password"
    
    # Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ©
    echo "ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ©..."
    
    # ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Firebase CLI Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    # Ø£Ùˆ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Firebase Console
    
    echo "âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©"
}

# Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…
test_system() {
    echo "ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…..."
    
    # ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
    echo "ğŸŒ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­..."
    firebase hosting:channel:open
    
    echo "âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…"
}

# Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø±
show_deployment_info() {
    echo "ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø±:"
    echo "=================="
    
    # Ø¹Ø±Ø¶ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹
    echo "ğŸŒ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹:"
    firebase hosting:channel:list
    
    # Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
    echo "ğŸ”§ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:"
    echo "Ù…Ø´Ø±ÙˆØ¹ Firebase: $(firebase projects:list | grep "*")"
    
    echo "âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­!"
}

# Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
main_menu() {
    echo ""
    echo "ğŸ“‹ Ø§Ø®ØªØ± Ø®ÙŠØ§Ø±Ø§Ù‹:"
    echo "1. Ù†Ø´Ø± ÙƒØ§Ù…Ù„ (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª)"
    echo "2. Ù†Ø´Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† ÙÙ‚Ø·"
    echo "3. Ù†Ø´Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙ‚Ø·"
    echo "4. Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Auth ÙÙ‚Ø·"
    echo "5. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙÙ‚Ø·"
    echo "6. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø·"
    echo "0. Ø¥Ù„ØºØ§Ø¡"
    echo ""
    
    read -p "Ø§Ø®ØªØ± Ø±Ù‚Ù… (0-6): " choice
    
    case $choice in
        1)
            check_requirements
            setup_firebase
            deploy_security_rules
            deploy_hosting
            setup_auth
            setup_initial_data
            test_system
            show_deployment_info
            ;;
        2)
            deploy_security_rules
            ;;
        3)
            deploy_hosting
            ;;
        4)
            setup_auth
            ;;
        5)
            setup_initial_data
            ;;
        6)
            test_system
            ;;
        0)
            echo "âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù†Ø´Ø±"
            exit 0
            ;;
        *)
            echo "âŒ Ø®ÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­"
            main_menu
            ;;
    esac
}

# Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°
echo ""
echo "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø³ÙƒØ±ÙŠØ¨Øª Ù†Ø´Ø± Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ"
echo "================================================="

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
if [ ! -f "index.html" ]; then
    echo "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"
    echo "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ÙÙŠ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØµØ­ÙŠØ­"
    exit 1
fi

# Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
main_menu

echo ""
echo "ğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†Ø´Ø±!"
echo "Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ"
echo "======================================="