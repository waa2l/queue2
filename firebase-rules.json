{
  "rules": {
    "users": {
      ".read": "auth != null",
      ".write": "auth != null && auth.uid == $uid",
      "$uid": {
        ".validate": "newData.hasChildren(['email', 'role', 'createdAt'])",
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$/)"
        },
        "role": {
          ".validate": "newData.isString() && (newData.val() == 'admin' || newData.val() == 'clinic' || newData.val() == 'display')"
        },
        "createdAt": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "clinics": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'clinic')",
      "$clinicId": {
        ".validate": "newData.hasChildren(['name', 'number', 'password', 'currentNumber', 'active'])",
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "number": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "password": {
          ".validate": "newData.isString() && newData.val().length >= 4"
        },
        "currentNumber": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "active": {
          ".validate": "newData.isBoolean()"
        },
        "screenId": {
          ".validate": "newData.isString()"
        },
        "lastCall": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "screens": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$screenId": {
        ".validate": "newData.hasChildren(['name', 'number', 'password', 'active'])",
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "number": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "password": {
          ".validate": "newData.isString() && newData.val().length >= 4"
        },
        "active": {
          ".validate": "newData.isBoolean()"
        }
      }
    },
    "calls": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$callId": {
        ".validate": "newData.hasChildren(['type', 'timestamp']) && (newData.child('type').val() == 'specific' && newData.hasChild('clinicId') && newData.hasChild('clientNumber') || newData.child('type').val() == 'emergency' && newData.hasChild('clinicId') || newData.child('type').val() == 'byName' && newData.hasChild('clinicId') && newData.hasChild('clientName'))",
        "type": {
          ".validate": "newData.isString() && (newData.val() == 'specific' || newData.val() == 'emergency' || newData.val() == 'byName')"
        },
        "clinicId": {
          ".validate": "newData.isString()"
        },
        "clientNumber": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "clientName": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "alerts": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$alertId": {
        ".validate": "newData.hasChildren(['message', 'timestamp'])",
        "message": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "type": {
          ".validate": "newData.isString()"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "adminAlerts": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$alertId": {
        ".validate": "newData.hasChildren(['message', 'from', 'timestamp'])",
        "message": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "from": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "transfers": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$transferId": {
        ".validate": "newData.hasChildren(['clientNumber', 'fromClinic', 'toClinic', 'timestamp'])",
        "clientNumber": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "fromClinic": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "fromClinicName": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "toClinic": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "toClinicName": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "settings": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "general": {
        ".validate": "newData.hasChildren(['centerName', 'newsTicker', 'alertDuration', 'speechRate', 'audioPath'])",
        "centerName": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "newsTicker": {
          ".validate": "newData.isString()"
        },
        "alertDuration": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 30"
        },
        "speechRate": {
          ".validate": "newData.isNumber() && newData.val() >= 0.5 && newData.val() <= 2.0"
        },
        "audioPath": {
          ".validate": "newData.isString() && newData.val().length > 0"
        }
      },
      "appointments": {
        ".validate": "newData.hasChildren(['morningSlots', 'eveningSlots', 'morningStart', 'morningEnd', 'eveningStart', 'eveningEnd'])",
        "morningSlots": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 50"
        },
        "eveningSlots": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 50"
        },
        "morningStart": {
          ".validate": "newData.isString() && newData.val().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/"
        },
        "morningEnd": {
          ".validate": "newData.isString() && newData.val().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/"
        },
        "eveningStart": {
          ".validate": "newData.isString() && newData.val().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/"
        },
        "eveningEnd": {
          ".validate": "newData.isString() && newData.val().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/"
        }
      },
      "video": {
        "autoPlay": {
          ".validate": "newData.isBoolean()"
        },
        "loop": {
          ".validate": "newData.isBoolean()"
        },
        "shuffle": {
          ".validate": "newData.isBoolean()"
        },
        "playlistId": {
          ".validate": "newData.isString()"
        }
      }
    },
    "videos": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$videoId": {
        ".validate": "newData.hasChildren(['url', 'title', 'addedAt'])",
        "url": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "title": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "addedAt": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "logs": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$clinicId": {
        "$logId": {
          ".validate": "newData.hasChildren(['action', 'timestamp', 'user']) && (newData.child('user').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin')",
          "action": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "details": {
            ".validate": "newData.isString()"
          },
          "timestamp": {
            ".validate": "newData.isNumber()"
          },
          "user": {
            ".validate": "newData.isString() && newData.val().length > 0"
          }
        }
      }
    },
    "statistics": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$clinicId": {
        "$date": {
          ".validate": "newData.hasChildren(['served', 'waiting', 'avgWaitTime'])",
          "served": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "waiting": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "avgWaitTime": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          }
        }
      }
    },
    "clientContacts": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$contactId": {
        ".validate": "newData.hasChildren(['clinicId', 'clientNumber', 'timestamp'])",
        "clinicId": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "clientNumber": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "email": {
          ".validate": "newData.isString()"
        },
        "phone": {
          ".validate": "newData.isString()"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    "complaints": {
      ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      ".write": true,
      "$complaintId": {
        ".validate": "newData.hasChildren(['type', 'text', 'timestamp', 'status'])",
        "type": {
          ".validate": "newData.isString() && (newData.val() == 'complaint' || newData.val() == 'suggestion')"
        },
        "name": {
          ".validate": "newData.isString()"
        },
        "phone": {
          ".validate": "newData.isString()"
        },
        "email": {
          ".validate": "newData.isString()"
        },
        "text": {
          ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 140"
        },
        "notes": {
          ".validate": "newData.isString()"
        },
        "clinicId": {
          ".validate": "newData.isString()"
        },
        "clientNumber": {
          ".validate": "newData.isNumber()"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        },
        "status": {
          ".validate": "newData.isString() && (newData.val() == 'pending' || newData.val() == 'resolved' || newData.val() == 'rejected')"
        }
      }
    },
    "consultations": {
      ".read": "auth != null && auth.uid == $uid",
      ".write": true,
      "$consultationId": {
        ".validate": "newData.hasChildren(['sessionId', 'userMessage', 'botResponse', 'timestamp']) && newData.child('sessionId').val().contains(auth.uid)",
        "sessionId": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "userMessage": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "botResponse": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        },
        "date": {
          ".validate": "newData.isString()"
        },
        "time": {
          ".validate": "newData.isString()"
        }
      }
    }
  }
}